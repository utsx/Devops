# –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å Yandex.Tank

–≠—Ç–æ—Ç –∫–∞—Ç–∞–ª–æ–≥ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è DevOps –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Yandex.Tank** –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è **HPA (Horizontal Pod Autoscaler)**.

## üéØ –¶–µ–ª—å

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è Kubernetes –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Ä–æ–≤–Ω—è—Ö –Ω–∞–≥—Ä—É–∑–∫–∏:
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å **scale-up** –ø—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å **scale-down** –ø—Ä–∏ —Å–Ω–∏–∂–µ–Ω–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏  
- –ò–∑–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏ HPA
- –û—Ü–µ–Ω–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Yandex.Tank

**–í–∞—Ä–∏–∞–Ω—Ç A: Python package**
```bash
pip install yandextank
```

**–í–∞—Ä–∏–∞–Ω—Ç B: Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)**
```bash
docker pull yandex/yandex-tank
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Kubernetes –∫–ª–∞—Å—Ç–µ—Ä –∑–∞–ø—É—â–µ–Ω
cd ../terraform
kubectl get pods -n devops-app

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ
curl -s http://89.169.142.28:32757/actuator/health
```

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü–æ–ª–Ω—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç
```bash
# –ó–∞–ø—É—Å–∫–∞–µ—Ç Tank + –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ HPA –≤ –æ–¥–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ
./run-load-test.sh
```

### –†–∞–∑–¥–µ–ª–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–µ—Ä–º–∏–Ω–∞–ª 1: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ HPA**
```bash
./monitor-hpa.sh
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 2: –ó–∞–ø—É—Å–∫ –Ω–∞–≥—Ä—É–∑–∫–∏**
```bash
# –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç
yandex-tank simple-load.yaml

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç  
yandex-tank load.yaml

# –ß–µ—Ä–µ–∑ Docker
docker run -v $(pwd):/var/loadtest --net host -it yandex/yandex-tank simple-load.yaml
```

## üìä –ü—Ä–æ—Ñ–∏–ª–∏ –Ω–∞–≥—Ä—É–∑–∫–∏

### Simple Load (simple-load.yaml)
- **–í—Ä–µ–º—è:** 10 –º–∏–Ω—É—Ç
- **–ü—Ä–æ—Ñ–∏–ª—å:** 1‚Üí30‚Üí60 RPS  
- **–¶–µ–ª—å:** –ë–∞–∑–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ scale-up

### Advanced Load (load.yaml)
- **–í—Ä–µ–º—è:** 15 –º–∏–Ω—É—Ç
- **–ü—Ä–æ—Ñ–∏–ª—å:** 1‚Üí50‚Üí100 RPS —Å –ø–ª–∞—Ç–æ
- **–¶–µ–ª—å:** –î–µ—Ç–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è HPA

## üéØ –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ HPA

| RPS | CPU Load | Memory Load | –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–ø–ª–∏–∫–∏ |
|-----|----------|-------------|-------------------|
| 1-10 | 0-5% | 60-70% | 1 (–º–∏–Ω–∏–º—É–º) |
| 10-30 | 5-10% | 70-85% | 1-2 |
| 30-60 | 10-15% | 85-110% | 2-3 (–º–∞–∫—Å–∏–º—É–º) |
| 60+ | >15% | >110% | 3 (–ª–∏–º–∏—Ç) |

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –í —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
# HPA —Å—Ç–∞—Ç—É—Å
watch kubectl get hpa -n devops-app

# –ü–æ–¥—ã –∏ –º–µ—Ç—Ä–∏–∫–∏  
watch kubectl top pods -n devops-app

# –°–æ–±—ã—Ç–∏—è HPA
kubectl get events -n devops-app --field-selector involvedObject.name=devops-backend-hpa
```

### Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
- **Tank Web UI:** http://localhost:8080 (–≤–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
- **Grafana:** http://89.169.142.28:32000 (admin/admin123)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
load-testing/
‚îú‚îÄ‚îÄ load.yaml                 # –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Tank
‚îú‚îÄ‚îÄ simple-load.yaml          # –ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Tank  
‚îú‚îÄ‚îÄ run-load-test.sh          # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ monitor-hpa.sh            # –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ HPA
‚îî‚îÄ‚îÄ scenarios/
    ‚îú‚îÄ‚îÄ api_scenario.txt      # HTTP —Å—Ü–µ–Ω–∞—Ä–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    ‚îî‚îÄ‚îÄ simple_ammo.txt       # –ü—Ä–æ—Å—Ç—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã (ammo file)
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:

### Tank —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- **–ì—Ä–∞—Ñ–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** –≤ Tank web UI
- **–õ–æ–≥–∏ –æ—Ç–≤–µ—Ç–æ–≤** –∏ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–∫–ª–∏–∫–∞
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—à–∏–±–æ–∫** –∏ —Ç–∞–π–º–∞—É—Ç–æ–≤

### HPA –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **CSV —Ñ–∞–π–ª** —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏: `terraform/hpa_monitoring.csv`
- **–õ–æ–≥–∏ —Å–æ–±—ã—Ç–∏–π** –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ì—Ä–∞—Ñ–∏–∫–∏ –≤ Grafana** —Å CPU/Memory metrics

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ endpoints
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `scenarios/simple_ammo.txt`:
```http
GET /your/custom/endpoint HTTP/1.1
Host: 89.169.142.28:32757
User-Agent: YandexTank/1.0
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è –Ω–∞–≥—Ä—É–∑–∫–∏
–í `simple-load.yaml` –∏–∑–º–µ–Ω–∏—Ç–µ `schedule`:
```yaml
load_profile:
  load_type: rps
  schedule: line(1, 20, 1m) const(20, 2m) line(20, 40, 1m)
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–æ–≤ –∞–≤—Ç–æ—Å—Ç–æ–ø–∞
```yaml
autostop:
  enabled: true
  autostop:
    - "http(5xx,20%,30s)"     # 20% –æ—à–∏–±–æ–∫ 5xx –∑–∞ 30 —Å–µ–∫
    - "quantile(95,2000ms,60s)" # 95% –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–¥–ª–µ–Ω–Ω–µ–µ 2 —Å–µ–∫
```

## üö® Troubleshooting

### Tank –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
yandex-tank --version

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
curl -I http://89.169.142.28:32757/actuator/health
```

### HPA –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–∞–≥—Ä—É–∑–∫—É
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ metrics-server
kubectl top pods -n devops-app

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ HPA
kubectl describe hpa devops-backend-hpa -n devops-app

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ—Ä–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
kubectl get hpa -n devops-app -o yaml
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥—ã
kubectl get pods -n devops-app

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
kubectl get svc -n devops-app

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É–∑–ª—ã –∫–ª–∞—Å—Ç–µ—Ä–∞
kubectl get nodes -o wide
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Yandex.Tank](https://yandextank.readthedocs.io/)
- [Kubernetes HPA](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è](../terraform/hpa-manifests.yaml)
